<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.commons.dao.AdminIndexDAO">
	<select id="selectMemberCNT" resultType="int">
		SELECT 
			COUNT(MEMBER_ID) AS MEMBER_COUNT
		FROM MEMBER
	</select>
	<select id="selectSubscribeCNT" resultType="int">
		SELECT 
			COUNT(SUBSCRIBE_ID) AS SUBSCRIBE_COUNT
		FROM 
			SUBSCRIBE
		WHERE SUBSCRIBE_USE = 'Y'
	</select>
	<select id="selectSubEndCloseComList" resultType="kr.or.ddit.commons.AdminIndexVO">
		<![CDATA[
		SELECT
		    SB.SUBSCRIBE_ID,
		    SB.SUBSCRIBE_END_DATE,
		    SB.MEMBER_ID,
		    M.MEMBER_NAME,
		    A.COMPANY_ID,
		    C.COMPANY_NAME
		FROM
		    SUBSCRIBE SB
		    JOIN MEMBER M ON SB.MEMBER_ID = M.MEMBER_ID
		    JOIN ASSOCIATION A ON SB.MEMBER_ID = A.MEMBER_ID
		    JOIN COMPANY C ON A.COMPANY_ID = C.COMPANY_ID
		WHERE
		    SUBSCRIBE_USE = 'Y'
		    AND SB.SUBSCRIBE_END_DATE > SYSDATE
		    AND SB.SUBSCRIBE_END_DATE <= SYSDATE + 30
		ORDER BY
		    SB.SUBSCRIBE_END_DATE
		]]>
	</select>
	<select id="joinCompanyMemberCNT" resultType="int">
		SELECT 
			COUNT(m.MEMBER_ID) AS memberCNT
		FROM 
			MEMBER m
			LEFT OUTER JOIN ASSOCIATION a ON m.MEMBER_ID = a.MEMBER_ID 
		WHERE 
			a.COMPANY_ID IS NOT NULL
	</select>
	<select id="selectSalesSUM" resultType="int">
		 SELECT 
		 	SUM(i.ITEM_PRICE) AS PRICE 
		 FROM SUBSCRIBE s 
			  JOIN ITEM i ON s.ITEM_ID = i.ITEM_ID 
	</select>
	<select id="selectSalesItemCNT" resultType="int">
		SELECT
			COUNT(B.ITEM_ID) AS CNT
		FROM ITEM A
			LEFT OUTER JOIN SUBSCRIBE B ON A.ITEM_ID=B.ITEM_ID
		GROUP BY 
			A.ITEM_ID,A.ITEM_NAME
	</select>
	<select id="selectMonthlySubscribeCNT" resultType="hashMap">

		SELECT
			(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/01') AS JANUARY
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/02') AS FEBRUARY
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/03') AS MARCH
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/04') AS APRIL
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/05') AS MAY
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/06') AS JUNE
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/07') AS JULY
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/08') AS AUGUST
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/09') AS SEPTEMBER
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/10') AS OCTOBER
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/11') AS NOVEMBER
			,(SELECT COUNT(ITEM_ID) AS CNT FROM SUBSCRIBE WHERE SUBSTR(to_char(SUBSCRIBE_START_DATE,'yyyy/mm/dd'),0,7)  = '2023/12') AS DECEMBER
		FROM DUAL
	</select>
	<select id="selectMonthlyJoinMemberCNT" resultType="hashMap">
		SELECT
			(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/01') AS JANUARY
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/02') AS FEBRUARY
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/03') AS MARCH
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/04') AS APRIL
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/05') AS MAY
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/06') AS JUNE
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/07') AS JULY
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/08') AS AUGUST
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/09') AS SEPTEMBER
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/10') AS OCTOBER
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/11') AS NOVEMBER
			,(SELECT COUNT(MEMBER_ID) AS CNT FROM MEMBER WHERE SUBSTR(to_char(MEMBER_JOINDATE,'yyyy/mm/dd'),0,7) = '2023/12') AS DECEMBER
		FROM DUAL
	</select>
	
</mapper>